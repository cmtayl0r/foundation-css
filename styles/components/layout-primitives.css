/*
- 👋 The Layout Container / Basic responsive container for layout
- ✅ The Stack / Vertical rhythm of items in a box
- ✅ The Box / Basic box padding
- ✅ The Cluster / Groups of similar elements
- 👋 The Sandwich / Vertical layout container
- 👨‍🔧 The Sidebar / Flex based responsive sidebar
- 👨‍🔧 The Switcher / Easy switch between horizontal and vertical layouts
- ✅ The Cover / Hero area layout
- ✅ The Grid / Simple layout of grid items
- ✅ The Frame / Image aspect ratio control
- ✅ The Reel / Overflow containers for horizontal scrolling
- ✅ The Imposter / Absolute positioned element
- ✅ The Icon / Icon container
*/

/*
================================================================================
THE LAYOUT CONTAINER
================================================================================
*/

/* ===== BASE CONTAINER ===== */
.layout-container {
  width: 100%;
  max-width: var(--container-lg);
  margin-inline: auto;
}

.layout-container--padding {
  padding-inline: var(--container-padding);
  /* Responsive padding */
}

/* ===== SEMANTIC CONTAINERS ===== */
/* Reading content optimization */
.layout-container--reading {
  max-width: var(--container-reading);
}

/* Long-form prose content */
.layout-container--prose {
  max-width: var(--container-content);
}

/* Chat interface container */
.layout-container--chat {
  max-width: var(--container-chat);
}

/* Code block container */
.layout-container--code {
  max-width: var(--container-content);
  font-family: var(--font-mono);
}

/*
================================================================================
THE STACK
================================================================================
*/

.stack {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

.stack>*+* {
  margin-block-start: var(--stack-space, var(--space-md, 1rem));
}

/* Semantic spacing variants */
.stack--tight {
  --stack-space: var(--space-sm);
}

.stack--loose {
  --stack-space: var(--space-lg, 2rem);
}

.stack--xl {
  --stack-space: var(--space-xl, 3rem);
}

/* flexbox allows to separate items vertically (i.e. Card) */
/*
.stack > :nth-child(2) {
    margin-block-end: auto;
}
*/
/* exception above and below */
/* or just above*/
.stack__exception,
.stack__exception>* {
  margin-block-start: var(--space-xl, 3rem) !important;
}

.stack:only-child {
  /* ↓ `height` in horizontal-tb writing mode */
  block-size: 100%;
}

/*
================================================================================
THE BOX
================================================================================
*/

.box {
  padding: var(--space-sm);
  color: var(--text-primary);
  background-color: var(--surface-page);
  outline: var(--space-sm) solid transparent;
  outline-offset: calc(-1 * var(--space-sm));
}

.box * {
  color: inherit;
}

.box.invert {
  color: var(--text-inverse);
  background-color: var(--surface-inverse);
}

@media (min-width: var(--breakpoint-md)) {
  .box {
    padding: var(--space-md);
  }
}

@media (min-width: var(--breakpoint-lg)) {
  .box {
    padding: var(--space-lg);
  }
}

@media (min-width: var(--breakpoint-xl)) {
  .box {
    padding: var(--space-xl);
  }
}

/*
================================================================================
THE CLUSTER
================================================================================
*/

.cluster {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
  justify-content: flex-start;
  align-items: center;
}

/* ===== JUSTIFICATION VARIANTS ===== */
.cluster--space {
  justify-content: space-between;
}

.cluster--center {
  justify-content: center;
}

.cluster--end {
  justify-content: flex-end;
}

/*
================================================================================
THE SANDWICH
================================================================================
*/

.sandwich {
  /* position: relative; */
  display: grid;
  grid-template-rows: auto 1fr auto;
  height: 100dvh;
  width: 100%;
}

.sandwich__head,
.sandwich__foot {
  position: sticky;
  z-index: var(--z-index-sticky);
  background: var(--surface-page);
}

.sandwich__head {
  top: 0;
}

.sandwich__foot {
  bottom: 0;
}

.sandwich__content {
  overflow-y: auto;
  scroll-padding-block: var(--space-md);
  z-index: 1;
  /* Smooth scrolling with momentum on iOS */
  -webkit-overflow-scrolling: touch;
}

/*
================================================================================
THE SIDEBAR
================================================================================
Main content first, sidebar second in DOM order for screen readers
*/

.with-sidebar {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
  container-type: inline-size;
  container-name: sidebar;
}

.with-sidebar> :first-child {
  /* ↓ The width when the sidebar _is_ a sidebar */
  flex-basis: var(--sidebar-width, 20rem);
  /* Set if sidebar fixed width */
  flex-grow: 1;
  order: 2;
  /* Sidebar comes second in layout */
}

.with-sidebar> :last-child {
  /* ↓ Grow from nothing */
  flex-basis: 0;
  flex-grow: 999;
  /* ↓ Wrap when the elements are of equal width (50%, or another %) */
  min-inline-size: var(--content-min-width, 60%);
  /* Determines when wrapping happens */
  order: 1;
  /* Content comes first in layout */
}

/* Right sidebar variant */
.with-sidebar--right> :first-child {
  order: 1;
}

.with-sidebar--right> :last-child {
  order: 2;
}

/* Responsive behavior */
@container sidebar (max-width: 768px) {
  .with-sidebar>* {
    order: initial !important;
    flex-basis: 100% !important;
  }
}

/*
================================================================================
THE SWITCHER
================================================================================
*/

.switcher {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
  container-type: inline-size;
}

.switcher>* {
  flex-grow: 1;
  /* ↓ 40rem is the threshold width to trigger the switch */
  flex-basis: calc((var(--switcher-threshold, 40rem) - 100%) * 999);
}

/* Limit to 4 items per row maximum */
.switcher> :nth-last-child(n + 5),
.switcher> :nth-last-child(n + 5)~* {
  flex-basis: 100%;
}

/* Accessible variants */
.switcher--2> :nth-last-child(n + 3),
.switcher--2> :nth-last-child(n + 3)~* {
  flex-basis: 100%;
}

.switcher--3> :nth-last-child(n + 4),
.switcher--3> :nth-last-child(n + 4)~* {
  flex-basis: 100%;
}

/*
================================================================================
THE COVER
================================================================================
*/

.cover {
  display: flex;
  flex-direction: column;
  min-block-size: var(--cover-height, 100dvh);
  padding: var(--space-md);
  container-type: block-size;
}

.cover>* {
  margin-block: var(--space-md);
}

.cover> :first-child:not(.cover__hero) {
  margin-block-start: 0;
}

.cover> :last-child:not(.cover__hero) {
  margin-block-end: 0;
}

/* Hero content (usually h1) */
.cover__hero {
  margin-block: auto;
  text-align: center;
}

/* Accessible background handling */
.cover--bg-image {
  position: relative;
  color: var(--text-on-image, var(--text-primary));
}

.cover--bg-image::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: -1;
}

/*
================================================================================
THE GRID
================================================================================
*/

.grid {
  display: grid;
  grid-gap: var(--space-md);
  container-type: inline-size;
  container-name: grid;
}

/* Modern auto-fit with intrinsic sizing */
@supports (width: min(250px, 100%)) {
  .grid {
    grid-template-columns: repeat(auto-fit,
        minmax(min(var(--grid-min-width, 250px), 100%), 1fr));
  }
}

/* Semantic variants */
.grid--cards {
  --grid-min-width: 300px;
  --grid-gap: var(--space-lg, 2rem);
}

.grid--compact {
  --grid-min-width: 200px;
  --grid-gap: var(--space-sm, 0.5rem);
}

.grid--reading {
  --grid-min-width: 65ch;
  --grid-gap: var(--space-xl, 3rem);
}

/*
================================================================================
THE FRAME
================================================================================
*/

.frame {
  --n: 16;
  --d: 9;
  aspect-ratio: var(--n) / var(--d);
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

.frame>img,
.frame>video {
  inline-size: 100%;
  block-size: 100%;
  object-fit: cover;
}

.frame.frame--4-3 {
  --n: 4;
  --d: 3;
  aspect-ratio: var(--n) / var(--d);
}

.frame.frame--3-2 {
  --n: 3;
  --d: 2;
  aspect-ratio: var(--n) / var(--d);
}

.frame.frame--1-1 {
  --n: 1;
  --d: 1;
  aspect-ratio: var(--n) / var(--d);
}

.frame.frame--3-4 {
  /* Portrait */
  --n: 3;
  --d: 4;
  aspect-ratio: var(--n) / var(--d);
}

/*
================================================================================
THE REEL
================================================================================
Announce as "scrollable region" if contains navigation
role="region" and aria-label requirements
*/

/*
root: {
--scrollbar-thumb: var(--color-neutral-500);
--scrollbar-track: var(--color-neutral-200);
--scrollbar-thumb-hover: var(--color-neutral-400);
--reel-gap: var(--space-md, 1rem);
--reel-padding: var(--space-md, 1rem);
}
*/

.reel {
  display: flex;
  overflow-x: auto;
  overflow-y: hidden;
  scroll-snap-type: x mandatory;
  scroll-padding-inline: var(--reel-padding, var(--space-md, 1rem));

  /* Accessible scrollbar styling */
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
  scrollbar-width: thin;

  /* Container setup */
  container-type: inline-size;
  padding: var(--reel-padding, var(--space-md, 1rem));
}

.reel>* {
  flex: 0 0 auto;
  scroll-snap-align: start;
}

.reel>*+* {
  margin-inline-start: var(--reel-gap, var(--space-md, 1rem));
}

.reel>img {
  block-size: 100%;
  flex-basis: auto;
  width: auto;
}

.reel--overflowing {
  padding-block-end: var(--space-md);
}

/* Scrollbar enhancements */
.reel::-webkit-scrollbar {
  block-size: 8px;
}

.reel::-webkit-scrollbar-track {
  background-color: var(--scrollbar-track);
  border-radius: 4px;
}

.reel::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb);
  border-radius: 4px;
}

.reel::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover);
}

/* Shadow affordance for overflow indication */
.reel::before,
.reel::after {
  content: '';
  position: sticky;
  z-index: 1;
  width: var(--space-md);
  flex-shrink: 0;
  pointer-events: none;
}

.reel::before {
  left: 0;
  background: linear-gradient(to right,
      var(--surface-page),
      transparent);
  margin-inline-end: calc(-1 * var(--space-md));
}

.reel::after {
  right: 0;
  background: linear-gradient(to left,
      var(--surface-page),
      transparent);
  margin-inline-start: calc(-1 * var(--space-md));
}

/* Variants */
.reel--cards>* {
  inline-size: min(300px, 80vw);
}

.reel--compact>* {
  inline-size: min(200px, 60vw);
}

/*
================================================================================
THE IMPOSTER
================================================================================
*/

.imposter {
  position: absolute;
  inset-block-start: 50%;
  inset-inline-start: 50%;
  transform: translate(-50%, -50%);
  z-index: var(--z-index-high, 1000);
}

.imposter--contain {
  overflow: auto;
  max-inline-size: calc(100vw - var(--imposter-margin, 2rem));
  max-block-size: calc(100vh - var(--imposter-margin, 2rem));
}

/* Prevent body scroll when imposter is active */
.imposter-active {
  overflow: hidden;
}

/*
================================================================================
THE ICON
================================================================================
*/

.icon {
  width: 1em;
  width: 1cap;
  height: 1em;
  height: 1cap;
  fill: currentColor;
  /* Icon color matches the text color */
  font-weight: var(--font-weight-text);
  /* Reset font weight for 3rd party Icons using <i> */
}

.with-icon {
  display: inline-flex;
  align-items: center;
  gap: var(--icon-gap, 0.5em);
}

.with-icon--baseline {
  align-items: baseline;
}

/*
================================================================================
ACCESSIBILITY ENHANCEMENTS
================================================================================
*/

/* Motion accessibility (WCAG 2.3.3, 2.2.2) */
@media (prefers-reduced-motion: reduce) {
  .reel {
    scroll-snap-type: none;
    /* Disable scroll snapping for reduced motion */
  }
}

/* High contrast accessibility (WCAG 1.4.11) */
@media (prefers-contrast: high) {}
